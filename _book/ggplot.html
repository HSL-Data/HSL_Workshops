<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data Visualization with ggplot2 | UVA Health Sciences Library Workshops</title>
  <meta name="description" content="This site hosts workshop tutorial materials for researchers in the life sciences at the University of Virginia to learn R skills." />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data Visualization with ggplot2 | UVA Health Sciences Library Workshops" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://hsl-workshops.netlify.com/" />
  <meta property="og:image" content="https://hsl-workshops.netlify.com/images/UVA_HSL.png" />
  <meta property="og:description" content="This site hosts workshop tutorial materials for researchers in the life sciences at the University of Virginia to learn R skills." />
  <meta name="github-repo" content="HSL-Data/HSL_Workshops" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data Visualization with ggplot2 | UVA Health Sciences Library Workshops" />
  
  <meta name="twitter:description" content="This site hosts workshop tutorial materials for researchers in the life sciences at the University of Virginia to learn R skills." />
  <meta name="twitter:image" content="https://hsl-workshops.netlify.com/images/UVA_HSL.png" />

<meta name="author" content="Data Services @ HSL" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/UVA_HSL.png" />
  <link rel="shortcut icon" href="images/UVA_HSL.png" type="image/x-icon" />
<link rel="prev" href="Intro.html">

<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-started"><i class="fa fa-check"></i>Getting Started</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-instructors"><i class="fa fa-check"></i>About the Instructors</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#david-n-martin-ms"><i class="fa fa-check"></i>David N Martin, MS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#marieke-k-jones-phd"><i class="fa fa-check"></i>Marieke K Jones, PhD</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Core Lessons</b></span></li>
<li class="chapter" data-level="1" data-path="Intro.html"><a href="Intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to R and RStudio</a><ul>
<li class="chapter" data-level="1.0.1" data-path="Intro.html"><a href="Intro.html#panes-in-rstudio"><i class="fa fa-check"></i><b>1.0.1</b> Panes in RStudio</a></li>
<li class="chapter" data-level="1.0.2" data-path="Intro.html"><a href="Intro.html#rstudio-global-options"><i class="fa fa-check"></i><b>1.0.2</b> RStudio Global Options</a></li>
<li class="chapter" data-level="1.1" data-path="Intro.html"><a href="Intro.html#set-up-an-r-project"><i class="fa fa-check"></i><b>1.1</b> Set up an R Project</a><ul>
<li class="chapter" data-level="1.1.1" data-path="Intro.html"><a href="Intro.html#download-learning-materials"><i class="fa fa-check"></i><b>1.1.1</b> Download learning materials</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Intro.html"><a href="Intro.html#r-as-a-calculator"><i class="fa fa-check"></i><b>1.2</b> R as a calculator</a><ul>
<li class="chapter" data-level="1.2.1" data-path="Intro.html"><a href="Intro.html#comments"><i class="fa fa-check"></i><b>1.2.1</b> Comments</a></li>
<li class="chapter" data-level="1.2.2" data-path="Intro.html"><a href="Intro.html#creating-r-objects"><i class="fa fa-check"></i><b>1.2.2</b> Creating R objects</a></li>
<li class="chapter" data-level="1.2.3" data-path="Intro.html"><a href="Intro.html#exercise-1"><i class="fa fa-check"></i><b>1.2.3</b> EXERCISE 1</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="Intro.html"><a href="Intro.html#functions"><i class="fa fa-check"></i><b>1.3</b> Functions</a><ul>
<li class="chapter" data-level="1.3.1" data-path="Intro.html"><a href="Intro.html#exercise-2"><i class="fa fa-check"></i><b>1.3.1</b> EXERCISE 2</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="Intro.html"><a href="Intro.html#more-functions"><i class="fa fa-check"></i><b>1.4</b> More Functions</a><ul>
<li class="chapter" data-level="1.4.1" data-path="Intro.html"><a href="Intro.html#exercise-3"><i class="fa fa-check"></i><b>1.4.1</b> EXERCISE 3</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="Intro.html"><a href="Intro.html#dataframes"><i class="fa fa-check"></i><b>1.5</b> DataFrames</a></li>
<li class="chapter" data-level="1.6" data-path="Intro.html"><a href="Intro.html#r-packages"><i class="fa fa-check"></i><b>1.6</b> R Packages</a></li>
<li class="chapter" data-level="1.7" data-path="Intro.html"><a href="Intro.html#inspecting-dataframes"><i class="fa fa-check"></i><b>1.7</b> Inspecting Dataframes</a></li>
<li class="chapter" data-level="1.8" data-path="Intro.html"><a href="Intro.html#accessing-variables"><i class="fa fa-check"></i><b>1.8</b> Accessing variables</a><ul>
<li class="chapter" data-level="1.8.1" data-path="Intro.html"><a href="Intro.html#exercise-4"><i class="fa fa-check"></i><b>1.8.1</b> EXERCISE 4</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="Intro.html"><a href="Intro.html#subset-a-dataframe-using-filter"><i class="fa fa-check"></i><b>1.9</b> Subset a dataframe using filter()</a><ul>
<li class="chapter" data-level="1.9.1" data-path="Intro.html"><a href="Intro.html#exercise-1.5"><i class="fa fa-check"></i><b>1.9.1</b> EXERCISE 1.5</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path="Intro.html"><a href="Intro.html#plots-in-base-r"><i class="fa fa-check"></i><b>1.10</b> Plots in base R</a><ul>
<li class="chapter" data-level="1.10.1" data-path="Intro.html"><a href="Intro.html#exercise-5"><i class="fa fa-check"></i><b>1.10.1</b> EXERCISE 5</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="Intro.html"><a href="Intro.html#write-csv-file"><i class="fa fa-check"></i><b>1.11</b> Write csv file</a></li>
<li class="chapter" data-level="1.12" data-path="Intro.html"><a href="Intro.html#saving-your-work-and-quitting-r"><i class="fa fa-check"></i><b>1.12</b> Saving your work and quitting R</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>2</b> Data Visualization with ggplot2</a><ul>
<li class="chapter" data-level="2.1" data-path="ggplot.html"><a href="ggplot.html#set-up"><i class="fa fa-check"></i><b>2.1</b> Set up</a></li>
<li class="chapter" data-level="2.2" data-path="ggplot.html"><a href="ggplot.html#read-in-data"><i class="fa fa-check"></i><b>2.2</b> Read in data</a></li>
<li class="chapter" data-level="2.3" data-path="ggplot.html"><a href="ggplot.html#data-pre-processing"><i class="fa fa-check"></i><b>2.3</b> Data Pre-Processing</a></li>
<li class="chapter" data-level="2.4" data-path="ggplot.html"><a href="ggplot.html#basics-of-ggplot2"><i class="fa fa-check"></i><b>2.4</b> Basics of ggplot2</a></li>
<li class="chapter" data-level="2.5" data-path="ggplot.html"><a href="ggplot.html#plotting-bivariate-data-continuous-x-and-continuous-y"><i class="fa fa-check"></i><b>2.5</b> Plotting bivariate data: continuous X and continuous Y</a><ul>
<li class="chapter" data-level="2.5.1" data-path="ggplot.html"><a href="ggplot.html#exercise-1-1"><i class="fa fa-check"></i><b>2.5.1</b> EXERCISE 1</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="ggplot.html"><a href="ggplot.html#tranformations"><i class="fa fa-check"></i><b>2.6</b> Tranformations</a><ul>
<li class="chapter" data-level="2.6.1" data-path="ggplot.html"><a href="ggplot.html#exercise-2-1"><i class="fa fa-check"></i><b>2.6.1</b> EXERCISE 2</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="ggplot.html"><a href="ggplot.html#facets"><i class="fa fa-check"></i><b>2.7</b> Facets</a></li>
<li class="chapter" data-level="2.8" data-path="ggplot.html"><a href="ggplot.html#plotting-bivariate-data-categorical-x-and-continuous-y"><i class="fa fa-check"></i><b>2.8</b> Plotting bivariate data: categorical X and continuous Y</a><ul>
<li class="chapter" data-level="2.8.1" data-path="ggplot.html"><a href="ggplot.html#exercise-3-1"><i class="fa fa-check"></i><b>2.8.1</b> EXERCISE 3</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="ggplot.html"><a href="ggplot.html#plotting-univariate-continuous-data"><i class="fa fa-check"></i><b>2.9</b> Plotting univariate continuous data</a></li>
<li class="chapter" data-level="2.10" data-path="ggplot.html"><a href="ggplot.html#saving-plots"><i class="fa fa-check"></i><b>2.10</b> Saving plots</a><ul>
<li class="chapter" data-level="2.10.1" data-path="ggplot.html"><a href="ggplot.html#exercise-4-1"><i class="fa fa-check"></i><b>2.10.1</b> EXERCISE 4</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="ggplot.html"><a href="ggplot.html#publication-ready-graphics"><i class="fa fa-check"></i><b>2.11</b> Publication ready graphics</a><ul>
<li class="chapter" data-level="2.11.1" data-path="ggplot.html"><a href="ggplot.html#custom-colors"><i class="fa fa-check"></i><b>2.11.1</b> Custom colors</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="ggplot.html"><a href="ggplot.html#learn-more-ggplot2"><i class="fa fa-check"></i><b>2.12</b> Learn More ggplot2</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">UVA Health Sciences Library Workshops</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Data Visualization with ggplot2</h1>
<p>This section will cover fundamental concepts for creating effective data visualization and will introduce tools and techniques for visualizing large, high-dimensional data using R. We will review fundamental concepts for visually displaying quantitative information, such as using series of small multiples, avoiding “chart-junk,” and maximizing the data-ink ratio. We will cover the grammar of graphics (geoms, aesthetics, stats, and faceting), and using the ggplot2 package to create plots layer-by-layer.</p>
<div id="set-up" class="section level2">
<h2><span class="header-section-number">2.1</span> Set up</h2>
<ol style="list-style-type: decimal">
<li>Start by downloading a dataset about tuberculosis to your local computer so you can play along. Right click the file link below to download</li>
</ol>
<p><a href="data/tb.csv">tb dat set</a></p>
<ol start="2" style="list-style-type: decimal">
<li><p>Move the tb file into a directory (folder) called data inside a directory called ggplot. Make sure you know where the ggplot folder is on your computer</p></li>
<li><p>Create a new R project in the ggplot directory you made in #2 (File –&gt; New Project –&gt; Existing Directory)</p></li>
<li><p>Start new script or Rmd file to play along</p></li>
</ol>
<p>For today’s lesson we will need packages in the tidyverse. You will need to have them installed and loaded</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load the tidyverse package</span>
<span class="kw">library</span>(tidyverse)

<span class="co"># if the library line errored out, uncomment the install line below and run it</span>
<span class="co"># install.packages(&quot;tidyverse&quot;)</span></code></pre>
</div>
<div id="read-in-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Read in data</h2>
<p>We are going to use the <code>tb</code> dataset today in class. This is a cleaned up version of data on Tuberculosis hosted by the <a href="https://www.who.int/tb/country/data/download/en/">World Health Organization</a>.</p>
<p>The below code will work if you have an R project set up and the tb.csv data file is inside a folder called data inside your project directory called ggplot. For more help setting up a project, go back to the Introductory Lesson /<span class="citation">@ref</span>(Intro)</p>
<pre class="sourceCode r"><code class="sourceCode r">tb &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/tb.csv&quot;</span>)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   country = col_character(),
##   who_region = col_character(),
##   year = col_double(),
##   pop = col_double(),
##   incidence_100k = col_double(),
##   incidence_number = col_double(),
##   hiv_percent = col_double(),
##   hiv_incidence_100k = col_double(),
##   hiv_number = col_double(),
##   mort_nohiv_100k = col_double(),
##   mort_nohiv_number = col_double(),
##   mort_hiv_100k = col_double(),
##   mort_hiv_number = col_double(),
##   mort_100k = col_double(),
##   mort_number = col_double(),
##   case_fatality_ratio = col_double(),
##   new_incidence_100k = col_double(),
##   case_detection_percent = col_double()
## )</code></pre>
<p>Let’s take a brief look with <code>glimpse()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(tb)</code></pre>
<pre><code>## Observations: 3,850
## Variables: 18
## $ country                &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanista…
## $ who_region             &lt;chr&gt; &quot;EMR&quot;, &quot;EMR&quot;, &quot;EMR&quot;, &quot;EMR&quot;, &quot;EMR&quot;, &quot;EMR&quot;,…
## $ year                   &lt;dbl&gt; 2000, 2001, 2002, 2003, 2004, 2005, 2006,…
## $ pop                    &lt;dbl&gt; 20093756, 20966463, 21979923, 23064851, 2…
## $ incidence_100k         &lt;dbl&gt; 190, 189, 189, 189, 189, 189, 189, 189, 1…
## $ incidence_number       &lt;dbl&gt; 38000, 40000, 42000, 44000, 46000, 47000,…
## $ hiv_percent            &lt;dbl&gt; 0.36, 0.30, 0.26, 0.23, 0.22, 0.22, 0.22,…
## $ hiv_incidence_100k     &lt;dbl&gt; 0.68, 0.57, 0.49, 0.44, 0.41, 0.42, 0.42,…
## $ hiv_number             &lt;dbl&gt; 140, 120, 110, 100, 100, 100, 110, 120, 1…
## $ mort_nohiv_100k        &lt;dbl&gt; 67.00, 62.00, 56.00, 57.00, 51.00, 46.00,…
## $ mort_nohiv_number      &lt;dbl&gt; 14000, 13000, 12000, 13000, 12000, 12000,…
## $ mort_hiv_100k          &lt;dbl&gt; 0.15, 0.17, 0.27, 0.25, 0.21, 0.19, 0.18,…
## $ mort_hiv_number        &lt;dbl&gt; 31, 35, 60, 57, 50, 48, 46, 45, 48, 55, 5…
## $ mort_100k              &lt;dbl&gt; 67.00, 62.00, 56.00, 57.00, 51.00, 46.00,…
## $ mort_number            &lt;dbl&gt; 14000, 13000, 12000, 13000, 12000, 12000,…
## $ case_fatality_ratio    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ new_incidence_100k     &lt;dbl&gt; 35, 48, 63, 60, 76, 87, 98, 108, 104, 93,…
## $ case_detection_percent &lt;dbl&gt; 19, 26, 33, 32, 40, 46, 52, 57, 55, 49, 5…</code></pre>
</div>
<div id="data-pre-processing" class="section level2">
<h2><span class="header-section-number">2.3</span> Data Pre-Processing</h2>
<p>We are going to be plotting 3 of the numeric variables today, incidence_100k, hiv_incidence_100k, and mort_100k.</p>
<p>Today’s lesson is about plotting using ggplot, so to make things a little cleaner, let’s filter the tb dataset for where those variables &gt;0.</p>
<p>In real life, we would certainly be interested in incidence = 0, so this clean up step will remove some important data. After you have familiarized yourself with plotting using ggplot2, I would encourage you to re-run the script with the full dataset. But let’s keep things simpler for now.</p>
<p>We’ll use a function <code>filter()</code> from the dplyr package (loaded as part of the tidyverse) that we saw in the Introductory lesson. The <code>filter()</code> function subsets a dataset for rows matching given logical criteria.</p>
<p>Let’s filter tb for where incidence_100k &gt; 0 and hiv_incidence_100k &gt; 0 and mort_100k &gt; 0</p>
<p>We’ll save the result onto tb to overwrite our original dataset with the cleaned up version we’ll use to plot.</p>
<pre class="sourceCode r"><code class="sourceCode r">tb &lt;-<span class="st"> </span>tb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(incidence_100k <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>hiv_incidence_100k <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>mort_100k <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</code></pre>
<p>We’ll use some more dplyr verbs to manipulate data throughout the lesson, but for now on to ggplot2</p>
</div>
<div id="basics-of-ggplot2" class="section level2">
<h2><span class="header-section-number">2.4</span> Basics of ggplot2</h2>
<p><strong>ggplot2</strong> is a widely used R package that extends R’s visualization capabilities. It takes the hassle out of things like creating legends, mapping other variables to scales like color, or faceting plots into small multiples. We’ll learn about what all these things mean shortly.</p>
<p><em>Where does the “gg” in ggplot2 come from?</em> The <strong>ggplot2</strong> package provides an R implementation of Leland Wilkinson’s <em>Grammar of Graphics</em> (1999). The <em>Grammar of Graphics</em> allows you to think beyond the garden variety plot types (e.g. scatterplot, barplot) and the consider the components that make up a plot or graphic, such as how data are represented on the plot (as lines, points, etc.), how variables are mapped to coordinates or plotting shape or color, what transformation or statistical summary is required, and so on.</p>
<p>Specifically, <strong>ggplot2</strong> allows you to build a plot layer-by-layer by specifying:</p>
<ul>
<li>a <strong>geom</strong> which specifies how the data are represented on the plot (points, lines, bars, etc.),</li>
<li><strong>aesthetics</strong> that map variables in the data to axes on the plot or to plotting size, shape, color, etc.,</li>
<li>a <strong>stat</strong> a statistical transformation or summary of the data applied prior to plotting,</li>
<li><strong>facets</strong> that allow the data to be divided into chunks on the basis of other categorical or continuous variables and the same plot drawn for each chunk.</li>
</ul>
<p><em>First, a note about <code>qplot()</code>.</em> The <code>qplot()</code> function is a quick way of making ggplot2 plots. You might see it if you look for help with ggplot2. It is a halfway step between plotting in base R and plotting in ggplot2, so if you’re used to making plots with built-in base graphics, the <code>qplot()</code> function will probably feel more familiar.</p>
<p>However, the sooner you abandon the <code>qplot()</code> syntax the sooner you’ll start to really understand ggplot2’s approach to building up plots layer by layer. This lesson should leave you feeling confident about your ability to plot in ggplot2, so let’s leave <code>qplot()</code> behind.</p>
</div>
<div id="plotting-bivariate-data-continuous-x-and-continuous-y" class="section level2">
<h2><span class="header-section-number">2.5</span> Plotting bivariate data: continuous X and continuous Y</h2>
<p>The <code>ggplot</code> function has two required arguments: the <em>data</em> used for creating the plot, and an <em>aesthetic</em> mapping to describe how variables in said data are mapped to things we can see on the plot.</p>
<p>First, let’s lay out the plot. If we want to plot a continuous Y variable by a continuous X variable we’re probably most interested in a scatter plot. Here, we’re telling ggplot that we want to use the <code>tb</code> dataset, and the aesthetic mapping will map <code>incidence_100k</code> onto the x-axis and <code>hiv_incidence_100k</code> onto the y-axis. Remember that the variable names are case sensitive!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k))</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-46-1.png" width="480" /></p>
<p>When we do that we get a blank canvas with no data showing. That’s because all we’ve done is laid out a two-dimensional plot specifying what goes on the x and y axes, but we haven’t told it what kind of geometric object to plot. The obvious choice here is a point. Check out <a href="http://docs.ggplot2.org/">docs.ggplot2.org</a> to see what kind of geoms are available.</p>
<p>Add <code>geom_point()</code> using a <code>+</code> after the canvas layer. It is important to notice that the parentheses around the canvas layer formed with the <code>ggplot()</code> function are fully closed, then each subquent layer is it’s own function added to the canvas with <code>+</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-47-1.png" width="480" /></p>
<p>Interesting pattern…</p>
<p>Let’s add some color by changing all the points to be blue</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-48-1.png" width="480" /></p>
<p>We put the <code>color = &quot;blue&quot;</code> argument in the <code>geom_point()</code> function because we would like to change the color of the points.</p>
<p>Now let’s change the shape of the points. <code>shape = 8</code> is an *</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">shape =</span> <span class="dv">8</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-49-1.png" width="480" /></p>
<p>Instead of coloring by a static value, let’s color by the who_region. This time, we will have to call <strong>aethetics</strong>. <em>Any time</em> you want to map a variable from the dataset onto the plot, it must be in a call to <code>aes()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region))</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-50-1.png" width="480" /></p>
<p>Let’s add another layer showing one smoothed trend line</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-51-1.png" width="480" /></p>
<p>Notice in the console output that <code>geom_smooth()</code> is fitting the trend line using a Generalized Additive Model (gam). We can read more about that by calling the help menu for geom_smooth</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ?geom_smooth</span></code></pre>
<p>Look at the Arguments section and read the bit about the method argument. We can specify a method, but if we allow the <code>method = &quot;auto&quot;</code> then it will fit loess for &lt; 1000 data points and gam for &gt;= 1000</p>
<p>Let’s change the method to be “lm” to fit a straight line</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-53-1.png" width="480" /></p>
<p>Clearly the lm is a poor fit for these raw data. Let’s fit a smoothed line (allowing the default <code>method = &quot;auto&quot;</code>) separately for each region. Because we want to map <code>who_region</code> onto the plot, we’ll put it in a call to <code>aes()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-54-1.png" width="480" /></p>
<p>Now each region is fit with method = “loess”</p>
<p>In the above code we now have three calls to <code>aes()</code>. One in the canvas layer, one in the <code>geom_point()</code> layer, and one in the <code>geom_smooth()</code> layer.</p>
<p>If we want ALL the layers to be colored by who_region, we can just specify color = who_region in <code>aes()</code> call in the top canvas layer and all the subsequent layers will inherit that aesthetic mapping just like they inherit the x and y from the canvas layer.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, 
               <span class="dt">y =</span> hiv_incidence_100k, 
               <span class="dt">color =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-55-1.png" width="480" /></p>
<div id="exercise-1-1" class="section level3">
<h3><span class="header-section-number">2.5.1</span> EXERCISE 1</h3>
<p>A. Create a new plot showing incidence_100k on the x axis and mort_100k on the y. Use <code>geom_point()</code></p>
<details>
<p><summary>SHOW ANSWER A</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> mort_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-56-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>B. Color the plot in #1 with points that are dark orange triangles (use shape = 17 and color = “darkorange”)</p>
<details>
<p><summary>SHOW ANSWER B</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> mort_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">17</span>, <span class="dt">color =</span> <span class="st">&quot;darkorange&quot;</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-57-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>C. Color the plot from #1 by the who_region</p>
<details>
<p><summary>SHOW ANSWER C</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> mort_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region))</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-58-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>D. Starting with your plot from #3, add the argument <code>alpha = .3</code> to the <code>geom_point()</code> function, outside the <code>aes()</code> function. What does alpha do?</p>
<details>
<p><summary>SHOW ANSWER D</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> mort_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">alpha =</span> <span class="fl">.3</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-59-1.png" width="480" /></p>
<p>Alpha adds transparency. Specifically an alpha of 1/2 will take 2 points overlapping to make it appear fully opaque. An alpha of 1/3 will take 3 points overlapping to make it appear fully opaque.</p>
</details>
<p><br>
</br></p>
</div>
</div>
<div id="tranformations" class="section level2">
<h2><span class="header-section-number">2.6</span> Tranformations</h2>
<p>In the plots we have created so far, it looks to me like we should show our incidence rates on a log axis.</p>
<p>We have a few options to accomplish this:
1. use dplyr’s <code>mutate()</code> function to create new, log-transformed variables
2. use the <code>log10()</code> directly in the <code>x =</code> and <code>y =</code> arguments of the plot
3. add log scales to the plot</p>
<p>Because today’s lesson is about the ggplot2 package, we will use the third option</p>
<p>Let’s start with the plot you created made in Exercise 1 problem D showing the tb incidence rate against the mortality rate colored by who_region.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> mort_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">alpha =</span> <span class="fl">.3</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-60-1.png" width="480" /></p>
<p>Let’s add a log10 scale to both the x and y axes</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> mort_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-61-1.png" width="480" /></p>
<p>Substitute smoothed lines colored by who_region instead of the geom_point()</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> mort_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-62-1.png" width="480" /></p>
<div id="exercise-2-1" class="section level3">
<h3><span class="header-section-number">2.6.1</span> EXERCISE 2</h3>
<p>A. Create a plot showing the log-transformed incidence_100k on x and log-transformed hiv_incidence_100k on y with smoothed lines colored for each who_region.</p>
<details>
<p><summary>SHOW ANSWER A</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-63-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>B. Turn off the gray standard error bands by including the argument <code>se = FALSE</code> to the <code>geom_smooth()</code> function, outside of the <code>aes()</code> function</p>
<details>
<p><summary>SHOW ANSWER B</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-64-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>C. Starting with your plot from B, add another layer to the plot that shows the data as geom_point() and set the transparency to 0.1.</p>
<details>
<p><summary>SHOW ANSWER C</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.1</span>)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-65-1.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># darkgray points under smooth</span>
<span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.1</span>, <span class="dt">color =</span> <span class="st">&quot;darkgrey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-65-2.png" width="480" /></p>
</details>
<p><br>
</br></p>
</div>
</div>
<div id="facets" class="section level2">
<h2><span class="header-section-number">2.7</span> Facets</h2>
<p>Facets display subsets of the data in different panels. There are a couple ways to do this, but <code>facet_wrap()</code> tries to sensibly wrap a series of facets into a 2-dimensional grid of small multiples.</p>
<p>The facet functions take a formula specifying which variables to facet by. If you have a look at the help for <code>?facet_wrap()</code> you’ll see that we can control how the wrapping is laid out.</p>
<p>Along the way to teaching you about faceting, I’ll show a strategy to build up a plot by saving layers you like to an object. This way, we can avoid having to copy-paste long lines of code.</p>
<p>Let’s start with a simple plot of incidence_100k on x and hiv_incidence_100k on y.</p>
<p>We’ll add the log-transformed axes, and then save that to an object called <code>p</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()

p</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-66-1.png" width="480" /></p>
<p>Add <code>geom_point()</code> colored darkgray and semi-transparent</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.2</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-67-1.png" width="480" /></p>
<p>Now we’ll facet by who_region to show each region in its own plot. As mentioned above, <code>facet_wrap()</code> takes a formula specifying which variable(s) to facet on, so that means we will provide a tilde and then the variable. This syntax sort of breaks our rule of mapping variables using <code>aes()</code> but I think the rationale is that faceting by definition must call a variable from the dataset so that is why we do not need <code>aes()</code></p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-68-1.png" width="480" /></p>
<p>Add transparency to <code>geom_point()</code>, add <code>geom_smooth()</code> layer colored by who_region with <code>se = FALSE</code></p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-69-1.png" width="480" /></p>
<p>In these plots, the facet and color are redundant mappings of who_region. We typically avoid redundant mappings, but there are reasons to do it (ie readability for color-blind) and in this case, I like the added color.</p>
</div>
<div id="plotting-bivariate-data-categorical-x-and-continuous-y" class="section level2">
<h2><span class="header-section-number">2.8</span> Plotting bivariate data: categorical X and continuous Y</h2>
<p>With the previous example we examined the relationship between a continuous X variable against a continuous Y variable. A scatter plot was the obvious type of data visualization.</p>
<p>But what if we wanted to visualize a categorical X variable and a continuous Y variable? One example would be x= who_region and y = incidence_100k.</p>
<p>First, let’s set up the basic plot:</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(who_region, incidence_100k))</code></pre>
<p>Add points</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-71-1.png" width="480" /></p>
<p>That’s not terribly useful. There’s a big overplotting problem because there is no variability in “AFR”.</p>
<p>What if we spread things out by adding a little bit of horizontal noise (aka “jitter”) to the data.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-72-1.png" width="480" /></p>
<p>Note that the little bit of horizontal noise that’s added to the jitter is random. If you run that command over and over again, each time it will look slightly different. The idea is to visualize the density at each vertical position, and spreading out the points horizontally allows you to do that.</p>
<p>Because there is still overplotting, let’s add some transparency by setting the <code>alpha</code> value for the jitter.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-73-1.png" width="480" /></p>
<p>We can also add in the log scale for the y-axis using the same code as before</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-74-1.png" width="480" /></p>
<p>Let’s save the scaled axis onto p and then recreate the plot</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>()

p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-75-1.png" width="480" /></p>
<p>Probably a more common visualization to show is a box plot:</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-76-1.png" width="480" /></p>
<p>Let’s raw data using jitter and the summary using a boxplot.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-77-1.png" width="480" /></p>
<p>Here, I added the jitter layer then added the boxplot layer, so the boxplot is plotted on top of the jitter layer.</p>
<p>Notice that the outliers in the boxplot layer are represented as points. But there’s no distinction between the outlier point from the boxplot geom and all the other points from the jitter geom.</p>
<p>Let’s change that by coloring the outliers.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.color =</span> <span class="st">&quot;red&quot;</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-78-1.png" width="480" /></p>
<p>There’s another geom that’s useful here, called a voilin plot.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-79-1.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_violin</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-79-2.png" width="480" /></p>
<p>Let’s go back to our boxplot for a moment.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-80-1.png" width="480" /></p>
<p>This plot would be a lot more effective if the who_regions were shown in some sort of order other than alphabetical. To do that, we’ll have to go back to our basic build of the plot again and use the <code>reorder()</code> function in our original aesthetic mapping.</p>
<p><code>reorder()</code> takes the first variable, which is some categorical variable, and orders it by the level of the mean of the second variable, which is a continuous variable.</p>
<p>It looks like this</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#reorder region by incidence</span>
<span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(who_region, incidence_100k), <span class="dt">y =</span> incidence_100k)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-81-1.png" width="480" /></p>
<div id="exercise-3-1" class="section level3">
<h3><span class="header-section-number">2.8.1</span> EXERCISE 3</h3>
<p>A. Make a jitter plot of who_region on x and hiv_incidence_100k on y.</p>
<details>
<p><summary>SHOW ANSWER A</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> who_region, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-82-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>B. Add a log-scale to the y-axis.</p>
<details>
<p><summary>SHOW ANSWER B</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> who_region, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-83-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>C. Add transparency.</p>
<details>
<p><summary>SHOW ANSWER C</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> who_region, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-84-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>D. Overlay a box plot with colored outliers.</p>
<details>
<p><summary>SHOW ANSWER D</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> who_region, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-85-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>BONUS. Reorder the plot by hiv_incidence_100k</p>
<details>
<p><summary>SHOW BONUS ANSWER</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reorder by LOG10 incidence!</span>
<span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(who_region, <span class="kw">log10</span>(hiv_incidence_100k)), <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-86-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
</div>
</div>
<div id="plotting-univariate-continuous-data" class="section level2">
<h2><span class="header-section-number">2.9</span> Plotting univariate continuous data</h2>
<p>What if we just wanted to visualize distribution of a single continuous variable? A histogram is the usual go-to visualization. Here we only have one aesthetic mapping instead of two.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(incidence_100k))</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-87-1.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set this as the canvas</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(incidence_100k))</code></pre>
<p>Add <code>geom_histogram()</code></p>
<pre class="sourceCode r"><code class="sourceCode r">p  <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-88-1.png" width="480" /></p>
<p>Add the log scale to the canvas and then re-create the plot</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()

p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-89-1.png" width="480" /></p>
<p>Notice the message in the console that geom_histogram is using <code>bins = 30</code> as a default. Let’s change the number of bins</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">100</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-90-1.png" width="480" /></p>
<p>Now try to color by who_region.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">bins =</span> <span class="dv">50</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-91-1.png" width="480" /></p>
<p>Well, that is not exactly what I meant. I wanted the inside of the bars colored. Many geoms have arguments that control the outside of the geom (color) and the inside of the geom (fill) separately. We wanted the argument fill instead of color</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region), <span class="dt">bins =</span> <span class="dv">50</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-92-1.png" width="480" /></p>
<p>If you look at the help for <code>?geom_histogram</code> you’ll see that by default it stacks overlapping data, so if two regions have a log incidence = 10, one is plotted on the bottom and the second is plotted stacked on top of the first. This is good to visualize the distribution of incidence_100k overall, but because we wanted to see a separate distribution for each region, this is misleading.</p>
<p>Let’s change the position argument so that each region has a baseline of 0.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-93-1.png" width="480" /></p>
<p>That’s better, but still not great. Try transparency</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.2</span>)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-94-1.png" width="480" /></p>
<p>Nope. That did not help at all. Try faceting instead.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-95-1.png" width="480" /></p>
<p>Great!</p>
<p>Let’s start back at p and plot a smoothed density curve instead of a histogram:</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-96-1.png" width="480" /></p>
<p>Notice that a density plot has a different y-axis than histograms. I like histograms when the actual count is important and density plots when comparing the shape across groups (ignoring the differences in sample size) is important.</p>
<p>Now color that by who_region</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region))</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-97-1.png" width="480" /></p>
<p>This could work for 2 or 3 groups, but with 6, this is crazy. Let’s facet instead</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-98-1.png" width="480" /></p>
<p>Change color to fill</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-99-1.png" width="480" /></p>
</div>
<div id="saving-plots" class="section level2">
<h2><span class="header-section-number">2.10</span> Saving plots</h2>
<p>There are a few ways to save ggplots. The quickest way, that works in an interactive session, is to use the <code>ggsave()</code> function. You give this function a file name and by default it saves the most recent plot that was printed to the screen.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;incidence.png&quot;</span>)</code></pre>
<p>That worked but the best way to save a plot is to pass <code>ggsave()</code> an R object containing the plot and then the file name.</p>
<p>First let’s create an R object containing our plot. I’ll use the opportunity to show you how to dictate the dimensions of the facet</p>
<pre class="sourceCode r"><code class="sourceCode r">pfinal &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region, <span class="dt">ncol =</span> <span class="dv">1</span>)
pfinal</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-101-1.png" width="480" /></p>
<p>Now we’ll call <code>ggsave()</code> to save out the plot.</p>
<p>We can adjust things like the width, height, and resolution. <code>ggsave()</code> also recognizes the name of the file extension and saves the appropriate kind of file. Let’s save <code>pfinal</code> as a PDF with dimensions 5x15 (inches).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(pfinal, <span class="dt">filename =</span> <span class="st">&quot;incidence.pdf&quot;</span>, <span class="dt">width=</span><span class="dv">5</span>, <span class="dt">height=</span><span class="dv">15</span>)</code></pre>
<div id="exercise-4-1" class="section level3">
<h3><span class="header-section-number">2.10.1</span> EXERCISE 4</h3>
<p>A. Start with a <code>filter()</code> statement to subset tb for just data from the year 2017.</p>
<details>
<p><summary>SHOW ANSWER A</summary></p>
<pre class="sourceCode r"><code class="sourceCode r">tb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>)</code></pre>
<pre><code>## # A tibble: 178 x 18
##    country who_region  year    pop incidence_100k incidence_number
##    &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;
##  1 Afghan… EMR         2017 3.55e7          189              67000
##  2 Albania EUR         2017 2.93e6           20                580
##  3 Algeria AFR         2017 4.13e7           70              29000
##  4 Angola  AFR         2017 2.98e7          359             107000
##  5 Argent… AMR         2017 4.43e7           26              12000
##  6 Armenia EUR         2017 2.93e6           36               1100
##  7 Austra… WPR         2017 2.45e7            6.8             1700
##  8 Austria EUR         2017 8.74e6            7.4              650
##  9 Azerba… EUR         2017 9.83e6           67               6500
## 10 Bahamas AMR         2017 3.95e5           15                 59
## # … with 168 more rows, and 12 more variables: hiv_percent &lt;dbl&gt;,
## #   hiv_incidence_100k &lt;dbl&gt;, hiv_number &lt;dbl&gt;, mort_nohiv_100k &lt;dbl&gt;,
## #   mort_nohiv_number &lt;dbl&gt;, mort_hiv_100k &lt;dbl&gt;, mort_hiv_number &lt;dbl&gt;,
## #   mort_100k &lt;dbl&gt;, mort_number &lt;dbl&gt;, case_fatality_ratio &lt;dbl&gt;,
## #   new_incidence_100k &lt;dbl&gt;, case_detection_percent &lt;dbl&gt;</code></pre>
</details>
<p><br>
</br></p>
<p>B. Using your filtered dataset, create a density plot for the log-transformed incidence_100k</p>
<details>
<p><summary>SHOW ANSWER B</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># keep piping using tb %&gt;% filter() as the dataset</span>
tb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-104-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>C. Facet by who_region and fill by region</p>
<details>
<p><summary>SHOW ANSWER C</summary></p>
<pre class="sourceCode r"><code class="sourceCode r">tb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region)</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-105-1.png" width="480" /></p>
</details>
<p><br>
</br></p>
<p>D. Save your figure in #3 to a 6x10 PDF file</p>
<details>
<p><summary>SHOW ANSWER D</summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first create an object out of the answer to C</span>
plot4 &lt;-<span class="st"> </span>tb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> who_region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>who_region)

<span class="co">#then save</span>
<span class="kw">ggsave</span>(plot4, <span class="dt">filename =</span> <span class="st">&quot;incidence2017.pdf&quot;</span>, <span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">height =</span> <span class="dv">6</span>)</code></pre>
</details>
<p><br>
</br></p>
</div>
</div>
<div id="publication-ready-graphics" class="section level2">
<h2><span class="header-section-number">2.11</span> Publication ready graphics</h2>
<p>Let’s make a plot we made earlier (x = incidence_100k, y = hiv_incidence_100k) with darkgray, transparent points and smooth curves colored by region without the standard error ribbon</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create the canvas</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tb, <span class="kw">aes</span>(<span class="dt">x =</span> incidence_100k, <span class="dt">y =</span> hiv_incidence_100k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()

p</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-107-1.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add the layers and save them onto p</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.1</span>, <span class="dt">color =</span> <span class="st">&quot;darkgrey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> who_region), <span class="dt">se =</span> <span class="ot">FALSE</span>)

p</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-107-2.png" width="480" /></p>
<p>Let’s add proper axes labels using labs(). Keep adding to create a title, subtitle, and better legend title (color)</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;TB Incidence per 100k&quot;</span>)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-108-1.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;TB Incidence per 100k&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;HIV Incidence per 100k TB cases&quot;</span>)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-108-2.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;TB Incidence per 100k&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;HIV Incidence per 100k TB cases&quot;</span>,
         <span class="dt">title =</span> <span class="st">&quot;TB and HIV in TB are directly related&quot;</span>,
         <span class="dt">subtitle =</span> <span class="st">&quot;Excluding incidences = 0&quot;</span>,
         <span class="dt">color =</span> <span class="st">&quot;WHO Region&quot;</span>)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-108-3.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># save the labs onto p</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;TB Incidence per 100k&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;HIV Incidence per 100k TB cases&quot;</span>,
         <span class="dt">title =</span> <span class="st">&quot;TB and HIV in TB are directly related&quot;</span>,
         <span class="dt">subtitle =</span> <span class="st">&quot;Excluding incidences = 0&quot;</span>,
         <span class="dt">color =</span> <span class="st">&quot;WHO Region&quot;</span>)</code></pre>
<p>All of the plots we have seen so far have used the default “gray” theme. A theme sets the background color, the look of the axes, color schemes, and the fonts. Let’s see some other options for themes</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-109-1.png" width="480" /></p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-109-2.png" width="480" /></p>
<p>Check out other <a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">ggthemes</a> if you’d like to see more options</p>
<div id="custom-colors" class="section level3">
<h3><span class="header-section-number">2.11.1</span> Custom colors</h3>
<p>Finally, we get to choose our own colors! So far we have only used the default ggplot2 colors. Let’s choose custom colors by name by adding a layer <code>scale_color_manual()</code> to our plot. Inside that function we will specify a vector of color names. Remember that to create a vector we use the function <code>c()</code> which stands for concatenate or combine.</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-110-1.png" width="480" /></p>
<p>To see all the colors with names in R:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colors</span>()</code></pre>
<p>There is a beautiful color pallette now built into ggplot2 called viridis. The viridis color scales are easier to read by those with colorblindness, and print well in grey scale. You can read more about the <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">viridis color scheme</a></p>
<p>When you start typing <code>scale_color_viridis</code>, you will see that there is a function ending in <code>_c</code> and one ending in <code>_d</code>. The c stands for continuous and the d is for discrete. Because our who-region is discrete, let’s choose that option.</p>
<p>Here is a basic discrete color scale:</p>
<pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_viridis_d</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-112-1.png" width="480" /></p>
<p>Finally, the <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf">RColorBrewer package</a> is also worth a look for several beautiful color combos.</p>
<p>Hopefully now you feel more confident in creating your own custom graphics in R using ggplot2</p>
</div>
</div>
<div id="learn-more-ggplot2" class="section level2">
<h2><span class="header-section-number">2.12</span> Learn More ggplot2</h2>
<ul>
<li>Chapters 3, 7 and 28 in <a href="http://r4ds.had.co.nz/">R 4 Data Science</a></li>
<li><a href="http://www.cookbook-r.com/Graphs/">R Graphics Cookbook</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">ggplot2 cheatsheet</a></li>
<li><a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">viridis color scale</a></li>
<li><a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">ggthemes package</a></li>
<li><a href="http://www.sthda.com/english/wiki/colors-in-r">Color in R</a></li>
</ul>

</div>
</div>






            </section>

          </div>
        </div>
      </div>
<a href="Intro.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
}
});
});
</script>

</body>

</html>
