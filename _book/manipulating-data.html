<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Manipulating Data | UVA Health Sciences Library Workshops</title>
  <meta name="description" content="This site hosts workshop tutorial materials for researchers in the life sciences at the University of Virginia to learn R skills." />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Manipulating Data | UVA Health Sciences Library Workshops" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://hsl-workshops.netlify.com/" />
  <meta property="og:image" content="https://hsl-workshops.netlify.com/images/UVA_HSL.png" />
  <meta property="og:description" content="This site hosts workshop tutorial materials for researchers in the life sciences at the University of Virginia to learn R skills." />
  <meta name="github-repo" content="HSL-Data/HSL_Workshops" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Manipulating Data | UVA Health Sciences Library Workshops" />
  
  <meta name="twitter:description" content="This site hosts workshop tutorial materials for researchers in the life sciences at the University of Virginia to learn R skills." />
  <meta name="twitter:image" content="https://hsl-workshops.netlify.com/images/UVA_HSL.png" />

<meta name="author" content="Data Services @ HSL" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/UVA_HSL.png" />
  <link rel="shortcut icon" href="images/UVA_HSL.png" type="image/x-icon" />
<link rel="prev" href="saving-your-work-and-quitting-r.html">
<link rel="next" href="taming-wild-data.html">
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-started"><i class="fa fa-check"></i>Getting Started</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-instructors"><i class="fa fa-check"></i>About the Instructors</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#david-n-martin-ms"><i class="fa fa-check"></i>David N Martin, MS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#marieke-k-jones-phd"><i class="fa fa-check"></i>Marieke K Jones, PhD</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Core Lessons</b></span></li>
<li class="chapter" data-level="1" data-path="Intro.html"><a href="Intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to R and RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="Intro.html"><a href="Intro.html#panes-in-rstudio"><i class="fa fa-check"></i><b>1.1</b> Panes in RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="set-up-an-r-project.html"><a href="set-up-an-r-project.html"><i class="fa fa-check"></i><b>2</b> Set up an R Project</a><ul>
<li class="chapter" data-level="2.1" data-path="set-up-an-r-project.html"><a href="set-up-an-r-project.html#download-learning-materials"><i class="fa fa-check"></i><b>2.1</b> Download learning materials</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-as-a-calculator.html"><a href="r-as-a-calculator.html"><i class="fa fa-check"></i><b>3</b> R as a calculator</a><ul>
<li class="chapter" data-level="3.1" data-path="r-as-a-calculator.html"><a href="r-as-a-calculator.html#comments"><i class="fa fa-check"></i><b>3.1</b> Comments</a></li>
<li class="chapter" data-level="3.2" data-path="r-as-a-calculator.html"><a href="r-as-a-calculator.html#creating-r-objects"><i class="fa fa-check"></i><b>3.2</b> Creating R objects</a></li>
<li class="chapter" data-level="3.3" data-path="r-as-a-calculator.html"><a href="r-as-a-calculator.html#exercise-1.1"><i class="fa fa-check"></i><b>3.3</b> EXERCISE 1.1</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>4</b> Functions</a><ul>
<li class="chapter" data-level="4.1" data-path="functions.html"><a href="functions.html#exercise-1.2"><i class="fa fa-check"></i><b>4.1</b> EXERCISE 1.2</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="more-functions.html"><a href="more-functions.html"><i class="fa fa-check"></i><b>5</b> More Functions</a><ul>
<li class="chapter" data-level="5.1" data-path="more-functions.html"><a href="more-functions.html#exercise-1.3"><i class="fa fa-check"></i><b>5.1</b> EXERCISE 1.3</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dataframes.html"><a href="dataframes.html"><i class="fa fa-check"></i><b>6</b> DataFrames</a></li>
<li class="chapter" data-level="7" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>7</b> R Packages</a></li>
<li class="chapter" data-level="8" data-path="inspecting-dataframes.html"><a href="inspecting-dataframes.html"><i class="fa fa-check"></i><b>8</b> Inspecting Dataframes</a></li>
<li class="chapter" data-level="9" data-path="accessing-variables.html"><a href="accessing-variables.html"><i class="fa fa-check"></i><b>9</b> Accessing variables</a><ul>
<li class="chapter" data-level="9.1" data-path="accessing-variables.html"><a href="accessing-variables.html#exercise-1.4"><i class="fa fa-check"></i><b>9.1</b> EXERCISE 1.4</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="subset-a-dataframe-using-filter.html"><a href="subset-a-dataframe-using-filter.html"><i class="fa fa-check"></i><b>10</b> Subset a dataframe using filter()</a><ul>
<li class="chapter" data-level="10.1" data-path="subset-a-dataframe-using-filter.html"><a href="subset-a-dataframe-using-filter.html#exercise-1.5"><i class="fa fa-check"></i><b>10.1</b> EXERCISE 1.5</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="plots-in-base-r.html"><a href="plots-in-base-r.html"><i class="fa fa-check"></i><b>11</b> Plots in base R</a><ul>
<li class="chapter" data-level="11.1" data-path="plots-in-base-r.html"><a href="plots-in-base-r.html#exercise-1.5-1"><i class="fa fa-check"></i><b>11.1</b> EXERCISE 1.5</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="write-csv-file.html"><a href="write-csv-file.html"><i class="fa fa-check"></i><b>12</b> Write csv file</a></li>
<li class="chapter" data-level="13" data-path="saving-your-work-and-quitting-r.html"><a href="saving-your-work-and-quitting-r.html"><i class="fa fa-check"></i><b>13</b> Saving your work and quitting R</a></li>
<li class="chapter" data-level="14" data-path="manipulating-data.html"><a href="manipulating-data.html"><i class="fa fa-check"></i><b>14</b> Manipulating Data</a><ul>
<li class="chapter" data-level="14.1" data-path="manipulating-data.html"><a href="manipulating-data.html#r-packages-1"><i class="fa fa-check"></i><b>14.1</b> R Packages</a></li>
<li class="chapter" data-level="14.2" data-path="manipulating-data.html"><a href="manipulating-data.html#read-in-data"><i class="fa fa-check"></i><b>14.2</b> Read in data</a></li>
<li class="chapter" data-level="14.3" data-path="manipulating-data.html"><a href="manipulating-data.html#review"><i class="fa fa-check"></i><b>14.3</b> Review</a><ul>
<li class="chapter" data-level="14.3.1" data-path="manipulating-data.html"><a href="manipulating-data.html#our-data"><i class="fa fa-check"></i><b>14.3.1</b> Our data</a></li>
<li class="chapter" data-level="14.3.2" data-path="manipulating-data.html"><a href="manipulating-data.html#reading-in-data"><i class="fa fa-check"></i><b>14.3.2</b> Reading in data</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="manipulating-data.html"><a href="manipulating-data.html#the-dplyr-package"><i class="fa fa-check"></i><b>14.4</b> The dplyr package</a></li>
<li class="chapter" data-level="14.5" data-path="manipulating-data.html"><a href="manipulating-data.html#dplyr-verbs"><i class="fa fa-check"></i><b>14.5</b> dplyr verbs</a><ul>
<li class="chapter" data-level="14.5.1" data-path="manipulating-data.html"><a href="manipulating-data.html#filter"><i class="fa fa-check"></i><b>14.5.1</b> filter()</a></li>
<li class="chapter" data-level="14.5.2" data-path="manipulating-data.html"><a href="manipulating-data.html#select"><i class="fa fa-check"></i><b>14.5.2</b> select()</a></li>
<li class="chapter" data-level="14.5.3" data-path="manipulating-data.html"><a href="manipulating-data.html#mutate"><i class="fa fa-check"></i><b>14.5.3</b> mutate()</a></li>
<li class="chapter" data-level="14.5.4" data-path="manipulating-data.html"><a href="manipulating-data.html#arrange"><i class="fa fa-check"></i><b>14.5.4</b> arrange()</a></li>
<li class="chapter" data-level="14.5.5" data-path="manipulating-data.html"><a href="manipulating-data.html#summarize"><i class="fa fa-check"></i><b>14.5.5</b> summarize()</a></li>
<li class="chapter" data-level="14.5.6" data-path="manipulating-data.html"><a href="manipulating-data.html#group_by"><i class="fa fa-check"></i><b>14.5.6</b> group_by()</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="manipulating-data.html"><a href="manipulating-data.html#the-pipe"><i class="fa fa-check"></i><b>14.6</b> The pipe: <strong>%&gt;%</strong></a><ul>
<li class="chapter" data-level="14.6.1" data-path="manipulating-data.html"><a href="manipulating-data.html#how-works"><i class="fa fa-check"></i><b>14.6.1</b> How %&gt;% works</a></li>
<li class="chapter" data-level="14.6.2" data-path="manipulating-data.html"><a href="manipulating-data.html#nesting-versus"><i class="fa fa-check"></i><b>14.6.2</b> Nesting versus %&gt;%</a></li>
<li class="chapter" data-level="14.6.3" data-path="manipulating-data.html"><a href="manipulating-data.html#piping-exercises"><i class="fa fa-check"></i><b>14.6.3</b> Piping exercises</a></li>
<li class="chapter" data-level="14.6.4" data-path="manipulating-data.html"><a href="manipulating-data.html#piping-into-plots"><i class="fa fa-check"></i><b>14.6.4</b> Piping into plots</a></li>
<li class="chapter" data-level="14.6.5" data-path="manipulating-data.html"><a href="manipulating-data.html#about-ggplot2"><i class="fa fa-check"></i><b>14.6.5</b> About ggplot2</a></li>
<li class="chapter" data-level="14.6.6" data-path="manipulating-data.html"><a href="manipulating-data.html#continuous-x-by-continuous-y"><i class="fa fa-check"></i><b>14.6.6</b> Continuous X by Continuous Y</a></li>
<li class="chapter" data-level="14.6.7" data-path="manipulating-data.html"><a href="manipulating-data.html#add-color-by-factorage"><i class="fa fa-check"></i><b>14.6.7</b> Add color by factor(Age)</a></li>
<li class="chapter" data-level="14.6.8" data-path="manipulating-data.html"><a href="manipulating-data.html#categorical-x-continuous-y-boxplot"><i class="fa fa-check"></i><b>14.6.8</b> Categorical X, Continuous Y –&gt; Boxplot</a></li>
<li class="chapter" data-level="14.6.9" data-path="manipulating-data.html"><a href="manipulating-data.html#line-plot"><i class="fa fa-check"></i><b>14.6.9</b> Line plot</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="manipulating-data.html"><a href="manipulating-data.html#resources"><i class="fa fa-check"></i><b>14.7</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="taming-wild-data.html"><a href="taming-wild-data.html"><i class="fa fa-check"></i><b>15</b> Taming Wild Data</a><ul>
<li class="chapter" data-level="15.0.1" data-path="taming-wild-data.html"><a href="taming-wild-data.html#our-data-1"><i class="fa fa-check"></i><b>15.0.1</b> Our data</a></li>
<li class="chapter" data-level="15.0.2" data-path="taming-wild-data.html"><a href="taming-wild-data.html#set-up-project-download-data"><i class="fa fa-check"></i><b>15.0.2</b> Set up project &amp; Download data</a></li>
<li class="chapter" data-level="15.1" data-path="taming-wild-data.html"><a href="taming-wild-data.html#tibble"><i class="fa fa-check"></i><b>15.1</b> Tibbles v. dataframe</a></li>
<li class="chapter" data-level="15.2" data-path="taming-wild-data.html"><a href="taming-wild-data.html#pipe"><i class="fa fa-check"></i><b>15.2</b> The pipe: <strong>%&gt;%</strong></a></li>
<li class="chapter" data-level="15.3" data-path="taming-wild-data.html"><a href="taming-wild-data.html#the-dplyr-package-1"><i class="fa fa-check"></i><b>15.3</b> The dplyr package</a><ul>
<li class="chapter" data-level="15.3.1" data-path="manipulating-data.html"><a href="manipulating-data.html#filter"><i class="fa fa-check"></i><b>15.3.1</b> filter()</a></li>
<li class="chapter" data-level="15.3.2" data-path="taming-wild-data.html"><a href="taming-wild-data.html#select-1"><i class="fa fa-check"></i><b>15.3.2</b> select()</a></li>
<li class="chapter" data-level="15.3.3" data-path="taming-wild-data.html"><a href="taming-wild-data.html#dplyr-in-action"><i class="fa fa-check"></i><b>15.3.3</b> dplyr in action</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="taming-wild-data.html"><a href="taming-wild-data.html#exercise-1"><i class="fa fa-check"></i><b>15.4</b> EXERCISE 1</a></li>
<li class="chapter" data-level="15.5" data-path="taming-wild-data.html"><a href="taming-wild-data.html#separate"><i class="fa fa-check"></i><b>15.5</b> Separate</a></li>
<li class="chapter" data-level="15.6" data-path="taming-wild-data.html"><a href="taming-wild-data.html#resources-for-regular-expressions"><i class="fa fa-check"></i><b>15.6</b> Resources for Regular Expressions</a></li>
<li class="chapter" data-level="15.7" data-path="taming-wild-data.html"><a href="taming-wild-data.html#exercise-2"><i class="fa fa-check"></i><b>15.7</b> EXERCISE 2</a><ul>
<li class="chapter" data-level="15.7.1" data-path="taming-wild-data.html"><a href="taming-wild-data.html#merge-gene-ontologies"><i class="fa fa-check"></i><b>15.7.1</b> Merge Gene Ontologies</a></li>
<li class="chapter" data-level="15.7.2" data-path="taming-wild-data.html"><a href="taming-wild-data.html#fix-nutrient-names"><i class="fa fa-check"></i><b>15.7.2</b> Fix Nutrient names</a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="taming-wild-data.html"><a href="taming-wild-data.html#break"><i class="fa fa-check"></i><b>15.8</b> Break</a></li>
<li class="chapter" data-level="15.9" data-path="taming-wild-data.html"><a href="taming-wild-data.html#more-fun-with-dplyr"><i class="fa fa-check"></i><b>15.9</b> More fun with dplyr</a></li>
<li class="chapter" data-level="15.10" data-path="taming-wild-data.html"><a href="taming-wild-data.html#exercise-3"><i class="fa fa-check"></i><b>15.10</b> EXERCISE 3</a><ul>
<li class="chapter" data-level="15.10.1" data-path="taming-wild-data.html"><a href="taming-wild-data.html#arrange-1"><i class="fa fa-check"></i><b>15.10.1</b> arrange()</a></li>
</ul></li>
<li class="chapter" data-level="15.11" data-path="taming-wild-data.html"><a href="taming-wild-data.html#exercise-4"><i class="fa fa-check"></i><b>15.11</b> EXERCISE 4</a><ul>
<li class="chapter" data-level="15.11.1" data-path="taming-wild-data.html"><a href="taming-wild-data.html#summarize-1"><i class="fa fa-check"></i><b>15.11.1</b> summarize()</a></li>
<li class="chapter" data-level="15.11.2" data-path="taming-wild-data.html"><a href="taming-wild-data.html#group_by-1"><i class="fa fa-check"></i><b>15.11.2</b> group_by()</a></li>
</ul></li>
<li class="chapter" data-level="15.12" data-path="taming-wild-data.html"><a href="taming-wild-data.html#exercise-5"><i class="fa fa-check"></i><b>15.12</b> EXERCISE 5</a></li>
<li class="chapter" data-level="15.13" data-path="taming-wild-data.html"><a href="taming-wild-data.html#exercise-6"><i class="fa fa-check"></i><b>15.13</b> EXERCISE 6</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html"><i class="fa fa-check"></i><b>16</b> Data Visualization with ggplot2</a><ul>
<li class="chapter" data-level="16.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#resources-to-learn-ggplot2"><i class="fa fa-check"></i><b>16.1</b> Resources to learn ggplot2</a></li>
<li class="chapter" data-level="16.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#make-sure-everyone-has-tidyverse-or-readr-dplyr-ggplot2"><i class="fa fa-check"></i><b>16.2</b> Make sure everyone has tidyverse or readr, dplyr, ggplot2</a></li>
<li class="chapter" data-level="16.3" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#download-data-and-make-a-new-project"><i class="fa fa-check"></i><b>16.3</b> Download data and make a new project</a><ul>
<li class="chapter" data-level="16.3.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#gapminder-data"><i class="fa fa-check"></i><b>16.3.1</b> Gapminder data</a></li>
<li class="chapter" data-level="16.3.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#dplyr-review"><i class="fa fa-check"></i><b>16.3.2</b> dplyr review</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#ggplot"><i class="fa fa-check"></i><b>16.4</b> About ggplot2</a></li>
<li class="chapter" data-level="16.5" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#plotting-bivariate-data-continuous-y-by-continuous-x"><i class="fa fa-check"></i><b>16.5</b> Plotting bivariate data: continuous Y by continuous X</a><ul>
<li class="chapter" data-level="16.5.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#adding-layers"><i class="fa fa-check"></i><b>16.5.1</b> Adding layers</a></li>
<li class="chapter" data-level="16.5.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#faceting"><i class="fa fa-check"></i><b>16.5.2</b> Faceting</a></li>
<li class="chapter" data-level="16.5.3" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#saving-plots"><i class="fa fa-check"></i><b>16.5.3</b> Saving plots</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#plotting-bivariate-data-continuous-y-by-categorical-x"><i class="fa fa-check"></i><b>16.6</b> Plotting bivariate data: continuous Y by categorical X</a></li>
<li class="chapter" data-level="16.7" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#plotting-univariate-continuous-data"><i class="fa fa-check"></i><b>16.7</b> Plotting univariate continuous data</a></li>
<li class="chapter" data-level="16.8" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#publication-ready-plots-themes"><i class="fa fa-check"></i><b>16.8</b> Publication-ready plots &amp; themes</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">UVA Health Sciences Library Workshops</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulating-data" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> Manipulating Data</h1>
<p>This chapter demonstrates techniques for data manipulation and analysis with the split-apply-combine strategy.</p>
<p>Before you begin this chapter, create a new RProject to house your script from this lesson and the nhanes dataset, which you can download by right clicking on the file below</p>
<p><a href="data/nhanes.csv">nhanes data set</a></p>
<div id="r-packages-1" class="section level2">
<h2><span class="header-section-number">14.1</span> R Packages</h2>
<p>First, we will learn to install and load a package in R and then we’ll use functions from that package.</p>
<p>To install a package, go down to the console pane and type <code>install.packages(&quot;name-of-package&quot;)</code>. Let’s use this code to install the readr package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;readr&quot;)</span></code></pre>
<p>You will only need to install the package once per computer, so that is why we do not preserve this line in the script.</p>
<p>This function will access internet and the Comprehensive R Archive Network (CRAN) to download a trusted version of the package.</p>
<p>Once you see the <code>&gt;</code> in the console, it means the download has finished. Now we’ll load the package in our script using the special function <code>library()</code>. If you need to create a new script, go to File –&gt; New –&gt; New R Script. Then type</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;readr&quot;</span>)</code></pre>
<p>Let’s install and load a second package called dplyr which has functions for manipulating datasets.</p>
<p>First go down to the console to install the package</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;dplyr&quot;)</span></code></pre>
<p>Then load the package by writing this line in your script</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</code></pre>
<p>Notice the messages that come out. The function ran and there is no error, but there is some text in red that we should read and understand.
This text tells us that there are now multiple functions called filter. When we call the <code>filter()</code> function, the one that will be chosen is from the dplyr package that we just loaded. If we want to run the <code>filter()</code> function from the stats package, we will now need to specify that (by calling <code>stats::filter()</code>).</p>
</div>
<div id="read-in-data" class="section level2">
<h2><span class="header-section-number">14.2</span> Read in data</h2>
<p>Now let’s read in some data. In the introductory chapter, we used the <code>read.csv()</code> function to read data into R. The object we created with that function was a dataframe.</p>
<p>This time, we’ll use a slightly different function, <code>read_csv()</code> to read in our data. The object that is created will be a tibble. A tibbles is a dataframe at its core, but it tweaks some older behaviors to make life a little easier. The main difference is</p>
</div>
<div id="review" class="section level2">
<h2><span class="header-section-number">14.3</span> Review</h2>
<div id="our-data" class="section level3">
<h3><span class="header-section-number">14.3.1</span> Our data</h3>
<p>The data we are going to look at is cleaned data from the National Health and Nutrition Examination Survey from the CDC.</p>
</div>
<div id="reading-in-data" class="section level3">
<h3><span class="header-section-number">14.3.2</span> Reading in data</h3>
<p>We need to load both the dplyr and readr packages for efficiently reading in and displaying this data. Both of them are included in the tidyverse package so we will just install and load that package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load packages</span>
<span class="co"># install.packages(&quot;tidyverse&quot;)</span>
<span class="kw">library</span>(tidyverse)

<span class="co"># Read in data</span>
nh &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file=</span><span class="st">&quot;data/nhanes.csv&quot;</span>)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   Gender = col_character(),
##   Race = col_character(),
##   Education = col_character(),
##   MaritalStatus = col_character(),
##   RelationshipStatus = col_character(),
##   Insured = col_character(),
##   HomeOwn = col_character(),
##   Work = col_character(),
##   Diabetes = col_character(),
##   PhysActive = col_character(),
##   SmokingStatus = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Display the data</span>
nh

<span class="co"># Optionally, bring up the data in a viewer window</span>
<span class="co"># View(nh)</span></code></pre>
<pre><code>## # A tibble: 5,000 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62172 female    43 Black High Sch… NeverMarried  Single          
##  3 62174 male      80 White College … Married       Committed       
##  4 62174 male      80 White College … Married       Committed       
##  5 62175 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  6 62176 female    34 White College … Married       Committed       
##  7 62178 male      80 White High Sch… Widowed       Single          
##  8 62180 male      35 White College … Married       Committed       
##  9 62186 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 62190 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## # … with 4,990 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
</div>
</div>
<div id="the-dplyr-package" class="section level2">
<h2><span class="header-section-number">14.4</span> The dplyr package</h2>
<p>The <a href="https://github.com/hadley/dplyr">dplyr package</a> is a relatively new R package that makes data manipulation fast and easy. It imports functionality from another package called magrittr that allows you to chain commands together into a pipeline that will completely change the way you write R code such that you’re writing code the way you’re thinking about the problem.</p>
<p>When you read in data with the readr package (<code>read_csv()</code>) and you had the dplyr package loaded already, the data frame takes on this “special” class of data frames called a <code>tbl</code> (pronounced “tibble”), which you can see with <code>class(nh)</code>. If you have other “regular” data frames in your workspace, the <code>as_tibble()</code> function will convert it into the special dplyr <code>tbl</code> that displays nicely (e.g.: <code>iris &lt;- as_tibble(iris)</code>). You don’t have to turn all your data frame objects into tibbles, but it does make working with large datasets a bit easier.</p>
<p>You can read more about tibbles in <a href="http://r4ds.had.co.nz/tibbles.html">Tibbles chapter in <em>R for Data Science</em></a> or in the <a href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html">tibbles vignette</a>. They keep most of the features of data frames, and drop the features that used to be convenient but are now frustrating (i.e. converting character vectors to factors). You can read more about the differences between data frames and tibbles in <a href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html#tibbles-vs-data-frames">this section of the tibbles vignette</a>, but the major convenience for us concerns <strong>printing</strong> (aka displaying) a tibble to the screen. When you print (i.e., display) a tibble, it only shows the first 10 rows and all the columns that fit on one screen. It also prints an abbreviated description of the column type. You can control the default appearance with options:</p>
<ul>
<li><code>options(tibble.print_max = n, tibble.print_min = m)</code>: if there are more than <em>n</em> rows, print only the first <em>m</em> rows. Use <code>options(tibble.print_max = Inf)</code> to always show all rows.</li>
<li><code>options(tibble.width = Inf)</code> will always print all columns, regardless of the width of the screen.</li>
</ul>
</div>
<div id="dplyr-verbs" class="section level2">
<h2><span class="header-section-number">14.5</span> dplyr verbs</h2>
<p>The dplyr package gives you a handful of useful <strong>verbs</strong> for managing data. On their own they don’t do anything that base R can’t do. Here are some of the <em>single-table</em> verbs we’ll be working with in this lesson (single-table meaning that they only work on a single table – contrast that to <em>two-table</em> verbs used for joining data together, which we’ll cover in a later lesson).</p>
<ol style="list-style-type: decimal">
<li><code>filter()</code></li>
<li><code>select()</code></li>
<li><code>mutate()</code></li>
<li><code>arrange()</code></li>
<li><code>summarize()</code></li>
<li><code>group_by()</code></li>
</ol>
<p>They all take a data frame or tibble as their input for the first argument, and they all return a data frame or tibble as output.</p>
<div id="filter" class="section level3">
<h3><span class="header-section-number">14.5.1</span> filter()</h3>
<p>If you want to filter <strong>rows</strong> of the data where some condition is true, use the <code>filter()</code> function.</p>
<ol style="list-style-type: decimal">
<li>The first argument is the data frame you want to filter, e.g. <code>filter(mnha, ...</code>.</li>
<li>The second argument is a condition you must satisfy, e.g. <code>filter(nh, Diabetes == &quot;Yes&quot;)</code>. If you want to satisfy <em>all</em> of multiple conditions, you can use the “and” operator, <code>&amp;</code>. The “or” operator <code>|</code> (the pipe character, usually shift-backslash) will return a subset that meet <em>any</em> of the conditions.</li>
</ol>
<ul>
<li><code>==</code>: Equal to</li>
<li><code>!=</code>: Not equal to</li>
<li><code>&gt;</code>, <code>&gt;=</code>: Greater than, greater than or equal to</li>
<li><code>&lt;</code>, <code>&lt;=</code>: Less than, less than or equal to</li>
</ul>
<p>Let’s try it out. For this to work you have to have already loaded the dplyr package (we loaded it when we ran library(tidyverse)).</p>
<p>Let’s take a look at just the people in the NHanes survey with Diabetes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, make sure you&#39;ve loaded the dplyr package from the tidyverse</span>
<span class="co"># library(tidyverse)</span>

<span class="co"># Look at just the people with Diabetes</span>
<span class="kw">filter</span>(nh, Diabetes <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>)</code></pre>
<pre><code>## # A tibble: 373 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62228 male      50 White College … Married       Committed       
##  2 62228 male      50 White College … Married       Committed       
##  3 62228 male      50 White College … Married       Committed       
##  4 62233 female    63 Mexi… 9 - 11th… Separated     Single          
##  5 62259 male      61 Black Some Col… Divorced      Single          
##  6 62302 female    51 Hisp… 8th Grade NeverMarried  Single          
##  7 62366 male      80 White High Sch… Married       Committed       
##  8 62368 female    80 Hisp… 8th Grade Widowed       Single          
##  9 62388 female    69 White High Sch… Widowed       Single          
## 10 62388 female    69 White High Sch… Widowed       Single          
## # … with 363 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Optionally, bring that result up in a View window</span>
<span class="co"># View(filter(nh, Diabetes == &quot;Yes&quot;))</span>

<span class="co"># Look at multiple Race categories</span>
<span class="kw">unique</span>(nh<span class="op">$</span>Race) <span class="co">#what race categories are there?</span></code></pre>
<pre><code>## [1] &quot;Asian&quot;    &quot;Black&quot;    &quot;White&quot;    &quot;Mexican&quot;  &quot;Hispanic&quot; &quot;Other&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(nh, Race <span class="op">==</span><span class="st">&quot;Asian&quot;</span> <span class="op">|</span><span class="st"> </span>Race <span class="op">==</span><span class="st">&quot;Black&quot;</span>)</code></pre>
<pre><code>## # A tibble: 877 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62172 female    43 Black High Sch… NeverMarried  Single          
##  3 62186 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  4 62220 female    31 Black College … NeverMarried  Single          
##  5 62223 male      54 Asian High Sch… Married       Committed       
##  6 62259 male      61 Black Some Col… Divorced      Single          
##  7 62271 male       7 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  8 62279 male      80 Black 9 - 11th… Widowed       Single          
##  9 62279 male      80 Black 9 - 11th… Widowed       Single          
## 10 62297 male      43 Black Some Col… Married       Committed       
## # … with 867 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Look at people of or under age 30 whose income greater than or equal to 70K</span>
<span class="kw">filter</span>(nh, Income <span class="op">&gt;=</span><span class="st"> </span><span class="dv">70000</span> <span class="op">&amp;</span><span class="st"> </span>Age <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>)</code></pre>
<pre><code>## # A tibble: 760 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62205 male      28 White College … NeverMarried  Single          
##  3 62205 male      28 White College … NeverMarried  Single          
##  4 62205 male      28 White College … NeverMarried  Single          
##  5 62205 male      28 White College … NeverMarried  Single          
##  6 62210 male      15 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  7 62225 female    13 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  8 62227 male      19 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  9 62235 female     2 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 62241 male       2 Hisp… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## # … with 750 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># YOUR TURN: How many people in the NHanes survey that meet the above two criteria are a racial minority (not white)?</span>
<span class="kw">filter</span>(nh, Age <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span> <span class="op">&amp;</span><span class="st"> </span>Race <span class="op">!=</span><span class="st"> &quot;White&quot;</span>)</code></pre>
<pre><code>## # A tibble: 993 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62186 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  3 62190 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  4 62219 female     2 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  5 62225 female    13 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  6 62241 male       2 Hisp… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  7 62257 female     2 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  8 62268 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  9 62271 male       7 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 62301 male      23 Black 9 - 11th… NeverMarried  Single          
## # … with 983 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<hr />
<p><strong>EXERCISE</strong>
1. Use <em>filter</em> to find out how many people in the 90th percentile for Weight have Diabetes. <em>Hint:</em> see <code>?quantile</code> and try <code>quantile(nh$Weight, probs=.90, na.rm = TRUE)</code> to see the weight value which is higher than 90% of all the data, then <code>filter()</code> based on that. Try wrapping your answer with a <code>dim()</code> function so you can see how many there were.</p>
<hr />
</div>
<div id="select" class="section level3">
<h3><span class="header-section-number">14.5.2</span> select()</h3>
<p>The <code>filter()</code> function allows you to return only certain <em>rows</em> matching a condition. The <code>select()</code> function returns only certain <em>columns</em>. The first argument is the data, and subsequent arguments are the columns you want.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Select just the Pulse and Blood Pressure variables</span>
<span class="kw">select</span>(nh, Pulse, BPSys, BPDia)</code></pre>
<pre><code>## # A tibble: 5,000 x 3
##    Pulse BPSys BPDia
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    72   107    37
##  2    80   103    72
##  3    56    97    39
##  4    56    97    39
##  5    NA    NA    NA
##  6    92   107    69
##  7    68   121    72
##  8    66   107    66
##  9    86   108    64
## 10    76   113    27
## # … with 4,990 more rows</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Alternatively, just remove columns. Remove the id and the HomeRooms and HomeOwn columns.</span>
<span class="kw">select</span>(nh, <span class="op">-</span>id, <span class="op">-</span>HomeRooms, <span class="op">-</span>HomeOwn)</code></pre>
<pre><code>## # A tibble: 5,000 x 29
##    Gender   Age Race  Education MaritalStatus RelationshipSta… Insured
##    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;  
##  1 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
##  2 female    43 Black High Sch… NeverMarried  Single           Yes    
##  3 male      80 White College … Married       Committed        Yes    
##  4 male      80 White College … Married       Committed        Yes    
##  5 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
##  6 female    34 White College … Married       Committed        Yes    
##  7 male      80 White High Sch… Widowed       Single           Yes    
##  8 male      35 White College … Married       Committed        Yes    
##  9 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
## 10 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
## # … with 4,990 more rows, and 22 more variables: Income &lt;dbl&gt;,
## #   Poverty &lt;dbl&gt;, Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;,
## #   Pulse &lt;dbl&gt;, BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;,
## #   HDLChol &lt;dbl&gt;, TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;,
## #   nPregnancies &lt;dbl&gt;, nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;,
## #   PhysActive &lt;chr&gt;, PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;,
## #   AlcoholYear &lt;dbl&gt;, SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Notice how the original data is unchanged - still have all 32 columns</span>
nh</code></pre>
<pre><code>## # A tibble: 5,000 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62172 female    43 Black High Sch… NeverMarried  Single          
##  3 62174 male      80 White College … Married       Committed       
##  4 62174 male      80 White College … Married       Committed       
##  5 62175 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  6 62176 female    34 White College … Married       Committed       
##  7 62178 male      80 White High Sch… Widowed       Single          
##  8 62180 male      35 White College … Married       Committed       
##  9 62186 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 62190 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## # … with 4,990 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
</div>
<div id="mutate" class="section level3">
<h3><span class="header-section-number">14.5.3</span> mutate()</h3>
<p>The <code>mutate()</code> function adds new columns to the data. Remember, it doesn’t actually modify the data frame you’re operating on, and the result is transient unless you assign it to a new object or reassign it back to itself (generally, not always a good practice).</p>
<p>The HDL to Total Cholesterol value can be predictive for risk of heart disease. Let’s mutate this data to add a new variable called “CholRatio” that is the HDLChol / TotChol.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(phys, <span class="dt">CholRatio=</span>HDLChol <span class="op">/</span><span class="st"> </span>TotChol)</code></pre>
</div>
<div id="arrange" class="section level3">
<h3><span class="header-section-number">14.5.4</span> arrange()</h3>
<p>The <code>arrange()</code> function takes a data frame or tbl and arranges (or sorts) by column(s) of interest. The first argument is the data, and subsequent arguments are columns to sort on. Use the <code>desc()</code> function to arrange by descending.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># arrange by Testosterone (default: increasing)</span>
<span class="kw">arrange</span>(nh, Testosterone)</code></pre>
<pre><code>## # A tibble: 5,000 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62276 male       9 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 63028 female     6 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  3 64932 male       6 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  4 64932 male       6 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  5 64932 male       6 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  6 65510 female    65 White 9 - 11th… Married       Committed       
##  7 66992 male       7 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  8 67524 male       6 Hisp… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  9 68534 female     8 Hisp… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 63588 female    80 White Some Col… Married       Committed       
## # … with 4,990 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># arrange by Weight (descending)</span>
<span class="kw">arrange</span>(nh, <span class="kw">desc</span>(Weight))</code></pre>
<pre><code>## # A tibble: 5,000 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 70466 female    25 White High Sch… LivePartner   Committed       
##  2 68256 female    46 Black Some Col… Married       Committed       
##  3 69207 female    30 Black High Sch… NeverMarried  Single          
##  4 70026 male      31 Black Some Col… NeverMarried  Single          
##  5 65773 male      34 Black College … Married       Committed       
##  6 66213 male      18 Other &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  7 63215 female    62 Black Some Col… Divorced      Single          
##  8 65537 male      21 White High Sch… NeverMarried  Single          
##  9 65537 male      21 White High Sch… NeverMarried  Single          
## 10 65537 male      21 White High Sch… NeverMarried  Single          
## # … with 4,990 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
</div>
<div id="summarize" class="section level3">
<h3><span class="header-section-number">14.5.5</span> summarize()</h3>
<p>The <code>summarize()</code> function summarizes multiple values to a single value. On its own the <code>summarize()</code> function doesn’t seem to be all that useful. The dplyr package provides a few convenience functions called <code>n()</code> and <code>n_distinct()</code> that tell you the number of observations or the number of distinct values of a particular variable.</p>
<p>Notice that summarize takes a data frame and returns a data frame. In this case it’s a 1x1 data frame with a single row and a single column. The name of the column, by default is whatever the expression was used to summarize the data. This usually isn’t pretty, and if we wanted to work with this resulting data frame later on, we’d want to name that returned value something easier to deal with.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the mean expression for all genes</span>
<span class="kw">summarize</span>(nh, <span class="kw">mean</span>(Weight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   `mean(Weight, na.rm = TRUE)`
##                          &lt;dbl&gt;
## 1                         70.3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use a more friendly name, e.g., meanWeight, or whatever you want to call it.</span>
<span class="kw">summarize</span>(nh, <span class="dt">meanWeight=</span><span class="kw">mean</span>(Weight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   meanWeight
##        &lt;dbl&gt;
## 1       70.3</code></pre>
</div>
<div id="group_by" class="section level3">
<h3><span class="header-section-number">14.5.6</span> group_by()</h3>
<p>We saw that <code>summarize()</code> isn’t that useful on its own. Neither is <code>group_by()</code> All this does is takes an existing data frame and coverts it into a grouped data frame where operations are performed by group.</p>
<pre class="sourceCode r"><code class="sourceCode r">nh</code></pre>
<pre><code>## # A tibble: 5,000 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62172 female    43 Black High Sch… NeverMarried  Single          
##  3 62174 male      80 White College … Married       Committed       
##  4 62174 male      80 White College … Married       Committed       
##  5 62175 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  6 62176 female    34 White College … Married       Committed       
##  7 62178 male      80 White High Sch… Widowed       Single          
##  8 62180 male      35 White College … Married       Committed       
##  9 62186 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 62190 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## # … with 4,990 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(nh, Race)</code></pre>
<pre><code>## # A tibble: 5,000 x 32
## # Groups:   Race [6]
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62172 female    43 Black High Sch… NeverMarried  Single          
##  3 62174 male      80 White College … Married       Committed       
##  4 62174 male      80 White College … Married       Committed       
##  5 62175 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  6 62176 female    34 White College … Married       Committed       
##  7 62178 male      80 White High Sch… Widowed       Single          
##  8 62180 male      35 White College … Married       Committed       
##  9 62186 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 62190 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## # … with 4,990 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(nh, Race, Diabetes)</code></pre>
<pre><code>## # A tibble: 5,000 x 32
## # Groups:   Race, Diabetes [18]
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  2 62172 female    43 Black High Sch… NeverMarried  Single          
##  3 62174 male      80 White College … Married       Committed       
##  4 62174 male      80 White College … Married       Committed       
##  5 62175 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
##  6 62176 female    34 White College … Married       Committed       
##  7 62178 male      80 White High Sch… Widowed       Single          
##  8 62180 male      35 White College … Married       Committed       
##  9 62186 female    17 Black &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## 10 62190 female    15 Mexi… &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;            
## # … with 4,990 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<p>The real power comes in where <code>group_by()</code> and <code>summarize()</code> are used together. First, write the <code>group_by()</code> statement. Then wrap the result of that with a call to <code>summarize()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the mean Weight for each race</span>
<span class="co"># group_by(nh, Race)</span>
<span class="kw">summarize</span>(<span class="kw">group_by</span>(nh, Race), <span class="dt">meanWeight=</span><span class="kw">mean</span>(Weight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre>
<pre><code>## # A tibble: 6 x 2
##   Race     meanWeight
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 Asian          59.8
## 2 Black          72.9
## 3 Hispanic       63.9
## 4 Mexican        63.2
## 5 Other          66.4
## 6 White          72.8</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the mean Weight for each race and Diabetes status</span>
<span class="co"># group_by(nh, Race, Diabetes)</span>
<span class="kw">summarize</span>(<span class="kw">group_by</span>(nh, Race, Diabetes), <span class="dt">meanWeight=</span><span class="kw">mean</span>(Weight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre>
<pre><code>## # A tibble: 18 x 3
## # Groups:   Race [6]
##    Race     Diabetes meanWeight
##    &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;
##  1 Asian    No            58.8 
##  2 Asian    Yes           79.8 
##  3 Asian    &lt;NA&gt;           7.05
##  4 Black    No            70.5 
##  5 Black    Yes           96.9 
##  6 Black    &lt;NA&gt;           7.12
##  7 Hispanic No            63.0 
##  8 Hispanic Yes           82.9 
##  9 Hispanic &lt;NA&gt;           8.6 
## 10 Mexican  No            62.9 
## 11 Mexican  Yes           88.7 
## 12 Mexican  &lt;NA&gt;           8.29
## 13 Other    No            66.0 
## 14 Other    Yes           95.6 
## 15 Other    &lt;NA&gt;           7.64
## 16 White    No            72.2 
## 17 White    Yes           91.6 
## 18 White    &lt;NA&gt;          11.1</code></pre>
</div>
</div>
<div id="the-pipe" class="section level2">
<h2><span class="header-section-number">14.6</span> The pipe: <strong>%&gt;%</strong></h2>
<div id="how-works" class="section level3">
<h3><span class="header-section-number">14.6.1</span> How %&gt;% works</h3>
<p>This is where things get awesome. The dplyr package imports functionality from the <a href="https://github.com/smbache/magrittr">magrittr</a> package that lets you <em>pipe</em> the output of one function to the input of another, so you can avoid nesting functions. It looks like this: <strong><code>%&gt;%</code></strong>. You don’t have to load the magrittr package to use it since dplyr imports its functionality when you load the dplyr package.</p>
<p>Here’s the simplest way to use it. Remember the <code>head()</code> function. It expects a data frame as input, and the next argument is the number of lines to print. These two commands are identical:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(nh, <span class="dv">5</span>)</code></pre>
<pre><code>## # A tibble: 5 x 32
##      id Gender   Age Race  Education MaritalStatus RelationshipSta… Insured
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;  
## 1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
## 2 62172 female    43 Black High Sch… NeverMarried  Single           Yes    
## 3 62174 male      80 White College … Married       Committed        Yes    
## 4 62174 male      80 White College … Married       Committed        Yes    
## 5 62175 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
## # … with 24 more variables: Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;,
## #   HomeOwn &lt;chr&gt;, Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;,
## #   Pulse &lt;dbl&gt;, BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;,
## #   HDLChol &lt;dbl&gt;, TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;,
## #   nPregnancies &lt;dbl&gt;, nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;,
## #   PhysActive &lt;chr&gt;, PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;,
## #   AlcoholYear &lt;dbl&gt;, SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre>
<pre><code>## # A tibble: 5 x 32
##      id Gender   Age Race  Education MaritalStatus RelationshipSta… Insured
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;  
## 1 62163 male      14 Asian &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
## 2 62172 female    43 Black High Sch… NeverMarried  Single           Yes    
## 3 62174 male      80 White College … Married       Committed        Yes    
## 4 62174 male      80 White College … Married       Committed        Yes    
## 5 62175 male       5 White &lt;NA&gt;      &lt;NA&gt;          &lt;NA&gt;             Yes    
## # … with 24 more variables: Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;,
## #   HomeOwn &lt;chr&gt;, Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;,
## #   Pulse &lt;dbl&gt;, BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;,
## #   HDLChol &lt;dbl&gt;, TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;,
## #   nPregnancies &lt;dbl&gt;, nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;,
## #   PhysActive &lt;chr&gt;, PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;,
## #   AlcoholYear &lt;dbl&gt;, SmokingStatus &lt;chr&gt;</code></pre>
<p>Let’s use one of the dplyr verbs.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(nh, SmokingStatus <span class="op">==</span><span class="st">&quot;Current&quot;</span>)</code></pre>
<pre><code>## # A tibble: 698 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62172 female    43 Black High Sch… NeverMarried  Single          
##  2 62232 female    42 White Some Col… Married       Committed       
##  3 62279 male      80 Black 9 - 11th… Widowed       Single          
##  4 62279 male      80 Black 9 - 11th… Widowed       Single          
##  5 62350 female    43 White High Sch… Divorced      Single          
##  6 62350 female    43 White High Sch… Divorced      Single          
##  7 62350 female    43 White High Sch… Divorced      Single          
##  8 62363 female    44 White 9 - 11th… Divorced      Single          
##  9 62397 female    70 Mexi… 8th Grade Widowed       Single          
## 10 62418 male      80 White 8th Grade Widowed       Single          
## # … with 688 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(SmokingStatus <span class="op">==</span><span class="st">&quot;Current&quot;</span>)</code></pre>
<pre><code>## # A tibble: 698 x 32
##       id Gender   Age Race  Education MaritalStatus RelationshipSta…
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
##  1 62172 female    43 Black High Sch… NeverMarried  Single          
##  2 62232 female    42 White Some Col… Married       Committed       
##  3 62279 male      80 Black 9 - 11th… Widowed       Single          
##  4 62279 male      80 Black 9 - 11th… Widowed       Single          
##  5 62350 female    43 White High Sch… Divorced      Single          
##  6 62350 female    43 White High Sch… Divorced      Single          
##  7 62350 female    43 White High Sch… Divorced      Single          
##  8 62363 female    44 White 9 - 11th… Divorced      Single          
##  9 62397 female    70 Mexi… 8th Grade Widowed       Single          
## 10 62418 male      80 White 8th Grade Widowed       Single          
## # … with 688 more rows, and 25 more variables: Insured &lt;chr&gt;,
## #   Income &lt;dbl&gt;, Poverty &lt;dbl&gt;, HomeRooms &lt;dbl&gt;, HomeOwn &lt;chr&gt;,
## #   Work &lt;chr&gt;, Weight &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;, Pulse &lt;dbl&gt;,
## #   BPSys &lt;dbl&gt;, BPDia &lt;dbl&gt;, Testosterone &lt;dbl&gt;, HDLChol &lt;dbl&gt;,
## #   TotChol &lt;dbl&gt;, Diabetes &lt;chr&gt;, DiabetesAge &lt;dbl&gt;, nPregnancies &lt;dbl&gt;,
## #   nBabies &lt;dbl&gt;, SleepHrsNight &lt;dbl&gt;, PhysActive &lt;chr&gt;,
## #   PhysActiveDays &lt;dbl&gt;, AlcoholDay &lt;dbl&gt;, AlcoholYear &lt;dbl&gt;,
## #   SmokingStatus &lt;chr&gt;</code></pre>
<p>Put it all together. Make a summary table of mean weight for each race and diabetes status (first filtering out Diabetes = NA). Then let’s round the means to 2 digits and sort the results by the mean weight of each group</p>
</div>
<div id="nesting-versus" class="section level3">
<h3><span class="header-section-number">14.6.2</span> Nesting versus %&gt;%</h3>
<p>So what?</p>
<p>Now, think about this for a minute. What if we wanted to get the mean weight separately for each Race only for Diabetes = Yes or No, and return a sorted list of those mean weights rounded to two digits? Mentally we would do something like this:</p>
<ol start="0" style="list-style-type: decimal">
<li>Take the <code>nh</code> dataset</li>
<li><em>then</em> <code>filter()</code> it for Diabetes Yes/No (!= NA)</li>
<li><em>then</em> <code>group_by()</code> the Race and Diabetes Status</li>
<li><em>then</em> <code>summarize()</code> to get the mean Weight for each group</li>
<li><em>then</em> <code>mutate()</code> to round the result of the above calculation to two significant digits</li>
<li><em>then</em> <code>arrange()</code> by the rounded mean weight above</li>
</ol>
<p>But in code, it gets ugly without the pipe.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(<span class="kw">mutate</span>(<span class="kw">summarize</span>(<span class="kw">group_by</span>(<span class="kw">filter</span>(nh, Diabetes <span class="op">!=</span><span class="st">&quot;NA&quot;</span>), Race, Diabetes), <span class="dt">meanWeight=</span><span class="kw">mean</span>(Weight, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)), <span class="dt">meanWeight=</span><span class="kw">round</span>(meanWeight, <span class="dv">2</span>)), meanWeight)</code></pre>
<p>Now compare that with the mental process of what you’re actually trying to accomplish. The way you would do this without pipes is completely inside-out and backwards from the way you express in words and in thought what you want to do. The pipe operator <code>%&gt;%</code> allows you to pass the output data frame from one function to the input data frame to another function.</p>
</div>
<div id="piping-exercises" class="section level3">
<h3><span class="header-section-number">14.6.3</span> Piping exercises</h3>
<p><strong>EXERCISE</strong></p>
<p>Here’s a warm-up round. Try the following.</p>
<p>Show the BPSys, BPDia, and TotChol for minority people when Weight &gt;= 100kg. <em>Hint:</em> 2 pipes: <code>filter</code> and <code>select</code>.</p>
<pre><code>## # A tibble: 204 x 3
##    BPSys BPDia TotChol
##    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1   120    71    5.09
##  2    98    59    3.26
##  3   137    66    3.62
##  4   118    54    4.55
##  5   118    54    4.55
##  6   150    84    6.44
##  7   110    69    5.72
##  8   134    80    3.72
##  9   134    80    3.72
## 10   134    80    3.72
## # … with 194 more rows</code></pre>
<p>Show the four female, current smokers with the highest Testosterone values. Return these womens’ Race, Pulse, and Weight. <em>Hint:</em> 4 pipes: <code>filter</code>, <code>arrange</code>, <code>head</code>, and <code>select</code>.</p>
<pre><code>## # A tibble: 4 x 3
##   Race  Pulse Weight
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 White    98   52.8
## 2 White    98   52.8
## 3 White    98   52.8
## 4 White    70   55.3</code></pre>
</div>
<div id="piping-into-plots" class="section level3">
<h3><span class="header-section-number">14.6.4</span> Piping into plots</h3>
<p>We should remove this section</p>
</div>
<div id="about-ggplot2" class="section level3">
<h3><span class="header-section-number">14.6.5</span> About ggplot2</h3>
<p><strong>ggplot2</strong> is a widely used R package that extends R’s visualization capabilities. It takes the hassle out of things like creating legends, mapping other variables to scales like color, or faceting plots into small multiples. We’ll learn about what all these things mean shortly.</p>
<p><em>Where does the “gg” in ggplot2 come from?</em> The <strong>ggplot2</strong> package provides an R implementation of Leland Wilkinson’s <em>Grammar of Graphics</em> (1999). The <em>Grammar of Graphics</em> allows you to think beyond the garden variety plot types (e.g. scatterplot, barplot) and the consider the components that make up a plot or graphic, such as how data are represented on the plot (as lines, points, etc.), how variables are mapped to coordinates or plotting shape or color, what transformation or statistical summary is required, and so on.</p>
<p>Specifically, <strong>ggplot2</strong> allows you to build a plot layer-by-layer by specifying:</p>
<ul>
<li>a <strong>geom</strong>, which specifies how the data are represented on the plot (points, lines, bars, etc.),</li>
<li><strong>aesthetics</strong> that map variables in the data to axes on the plot or to plotting size, shape, color, etc.,</li>
<li>a <strong>stat</strong>, a statistical transformation or summary of the data applied prior to plotting,</li>
<li><strong>facets</strong>, which we’ve already seen above, that allow the data to be divided into chunks on the basis of other categorical or continuous variables and the same plot drawn for each chunk.</li>
</ul>
</div>
<div id="continuous-x-by-continuous-y" class="section level3">
<h3><span class="header-section-number">14.6.6</span> Continuous X by Continuous Y</h3>
<p>Plot Height by Weight</p>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Height, <span class="dt">y =</span> Weight)) <span class="co">#nothing happened...why not?</span></code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Height, <span class="dt">y =</span> Weight)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<pre><code>## Warning: Removed 166 rows containing missing values (geom_point).</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-56-2.png" width="672" /></p>
</div>
<div id="add-color-by-factorage" class="section level3">
<h3><span class="header-section-number">14.6.7</span> Add color by factor(Age)</h3>
<p>Create a new variable called Age2 using mutate and cut that codes Age &lt;= 18 as child and Age &gt;18 as adult. Then color the above plot by Age2</p>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Age2 =</span> <span class="kw">cut</span>(Age, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">18</span>, <span class="ot">Inf</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;child&quot;</span>, <span class="st">&quot;adult&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Height, <span class="dt">y =</span> Weight, <span class="dt">color =</span> Age2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<pre><code>## Warning: Removed 166 rows containing missing values (geom_point).</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<div id="categorical-x-continuous-y-boxplot" class="section level3">
<h3><span class="header-section-number">14.6.8</span> Categorical X, Continuous Y –&gt; Boxplot</h3>
<p>filter out the Race = Other category,
Plot Race on the X and Weight on the Y. Color the plot by Gender.</p>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Race <span class="op">!=</span><span class="st"> &quot;Other&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Race, Weight, <span class="dt">fill =</span> Gender)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<pre><code>## Warning: Removed 31 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
</div>
<div id="line-plot" class="section level3">
<h3><span class="header-section-number">14.6.9</span> Line plot</h3>
<p>Graph age against mean height at that age</p>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanHeight =</span> <span class="kw">mean</span>(Height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Age, meanHeight)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_path).</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>Color that graph by Race
**need to add Race into group_by call</p>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Race, Age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanHeight =</span> <span class="kw">mean</span>(Height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> meanHeight, <span class="dt">color =</span> Race)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_path).</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>Make it a bit prettier and easier to read</p>
<pre class="sourceCode r"><code class="sourceCode r">nh <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Race, Age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanHeight =</span> <span class="kw">mean</span>(Height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> meanHeight, <span class="dt">color =</span> Race)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 12 rows containing non-finite values (stat_smooth).</code></pre>
<p><img src="Book_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
</div>
<div id="resources" class="section level2">
<h2><span class="header-section-number">14.7</span> Resources</h2>
<ul>
<li><a href="http://r4ds.had.co.nz/tibbles.html#introduction-4"><em>Introduction</em>(10.1)</a> and <a href="http://r4ds.had.co.nz/tibbles.html#tibbles-vs.data.frame"><em>Tibbles vs. data.frame</em> (10.3)</a> sections of the <a href="http://r4ds.had.co.nz/tibbles.html"><strong><em>R for Data Science</em> book</strong></a>.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="saving-your-work-and-quitting-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="taming-wild-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
